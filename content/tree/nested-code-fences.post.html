<!-- date: 2026-01-19 -->
<!-- title: Nested Code Fences in Markdown -->
<!-- tag: Web, Technology -->
<!-- key: ncfim -->
<!-- import: extra.css -->
<!-- blog: Main -->
<p>
  Today, we will meet a spiky-haired nerd named Corey Dumm, who
  normally lives within Markdown code fences.  We will get to know him
  a bit, smile with him when his fences hold and weep quietly when
  misfortune strikes.
</p>
<p>
  One of the caveats of the Markdown universe is the wide variety of
  Markdown implementations available.  In these parallel universes,
  the rules of Markdown rendering differ subtly.  In this post, we
  will focus only on the CommonMark specification.  Since GitHub
  Flavoured Markdown (GFM) is a strict superset of CommonMark,
  whatever we discuss here applies equally well to both CommonMark and
  GFM.
</p>
{{ toc }}
<h2 id="basic-code-fences">Basic Code Fences</h2>
<p>
  Corey had a knack for working with computers ever since he was a
  kid.
</p>
<!-- Markdown #1 -->
<pre><code>Corey at his computer:

```
(o_o)--.|[_]|
```</code></pre>
<p>
  Everything was perfect in Corey's world.  The CommonMark renderer
  would convert the Markdown above to the following HTML:
</p>
<!-- Rendered HTML #1 -->
<div class="box">
<p>Corey at his computer:</p>
<pre><code>(o_o)--.|[_]|
</code></pre>
</div>
<!-- Raw HTML #1 -->
<details>
<summary>View HTML</summary>
<pre><code>&lt;p&gt;Corey at his computer:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;(o_o)--.|[_]|
&lt;/code&gt;&lt;/pre&gt;</code></pre>
</details>
<p>
  At this point, all was well.  Corey grew quickly.  Before long, he
  had a head full of spiky hair.  Then the fences began to matter.
</p>
<!-- Markdown #2 -->
<pre><code>Corey, all grown up:

```
 ```
(o_o)--.|[_]|
```</code></pre>
<p>
  Let us see how this renders.  I must warn you that during the
  Markdown-to-HTML translation, Corey loses his hair.  Some viewers
  may find the following scene disturbing.  Viewer discretion is
  advised.  Here is the rendered HTML:
</p>
<!-- Rendered HTML #2 -->
<div class="box">
<p>Corey, all grown up:</p>
<pre><code></code></pre>
<p>(o_o)--.|[_]|</p>
<pre><code></code></pre>
</div>
<!-- Raw HTML #2 -->
<details>
<summary>View HTML</summary>
<pre><code>&lt;p&gt;Corey, all grown up:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(o_o)--.|[_]|&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</code></pre>
</details>
<p>
  Corey's hair is gone!  What a catastrophic accident!  Corey is
  alright, though.  He is still quite afraid of Markdown fences, but
  otherwise well and bouncing back.  Why did this happen?  The second
  set of triple backticks immediately ends the fenced code block
  started by the first set of triple backticks.  As a result, Corey's
  smiley face ends up outside the fenced code block.  The triple
  backticks that were once Corey's hair are now woven into the fabric
  of the surrounding HTML.  Fortunately, CommonMark offers a few ways
  to avoid such accidents.
</p>
<h2 id="fancy-code-fences">Fancy Code Fences</h2>
<p>
  In CommonMark, there are two main ways to include triple backticks
  within fenced code blocks.  First, we can use tildes as the code
  fence:
</p>
<!-- Markdown #3a -->
<pre><code>Corey, all grown up:

~~~
 ```
(o_o)--.|[_]|
~~~</code></pre>
<p>
  In fact, a code fence need not consist of exactly three backticks or
  tildes.  Any number of backticks or tildes is allowed, as long as
  that number is at least three.  The following is therefore
  equivalent:
</p>
<!-- Markdown #3b -->
<pre><code>Corey, all grown up:

~~~~~
 ```
(o_o)--.|[_]|
~~~~~</code></pre>
<p>
  And so is this:
</p>
<!-- Markdown #3c -->
<pre><code>Corey, all grown up:

`````
 ```
(o_o)--.|[_]|
`````</code></pre>
<p>
  All three examples render like this:
</p>
<!-- Rendered HTML #3 -->
<div class="box">
<p>Corey, all grown up:</p>
<pre><code> ```
(o_o)--.|[_]|
</code></pre>
</div>
<!-- Raw HTML #3 -->
<details>
<summary>View HTML</summary>
<pre><code>&lt;p&gt;Corey, all grown up:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; ```
(o_o)--.|[_]|
&lt;/code&gt;&lt;/pre&gt;</code></pre>
</details>
<p>
  No hair is lost in translation.
</p>
<h2 id="basic-code-spans">Basic Code Spans</h2>
<p>
  A similar problem arises with inline code spans.  Most Markdown
  users know to use backticks to delimit inline code spans.  For
  example:
</p>
<!-- Markdown 4 -->
<pre><code>An old picture of Corey at his computer: `(o_o)--.|[_]|`</code></pre>
<p>
  This produces the following output:
</p>
<!-- Rendered HTML 4 -->
<div class="box">
<p>An old picture of Corey at his computer: <code>(o_o)--.|[_]|</code></p>
</div>
<!-- Raw HTML 4 -->
<details>
<summary>View HTML</summary>
<pre><code>&lt;p&gt;An old picture of Corey at his computer: &lt;code&gt;(o_o)--.|[_]|&lt;/code&gt;&lt;/p&gt;</code></pre>
</details>
<p>
  However, what do we do when we need to put Corey's dear friend Becky
  Trace within an inline code span?  Becky has short, straight hair
  tucked neatly on either side of her face.  Here's a picture of her:
</p>
<p class="textcenter">
  <code>`(o_o)`</code>
</p>
<p>
  I believe you can already see the difficulty here.  Inline code
  spans use backticks as delimiters.  So when we put Becky within a
  code span, the first backtick in Becky's face would terminate the
  code span immediately and then the rest of Becky would lie outside
  it.  CommonMark offers solutions for this kind of situation as well.
</p>
<h2 id="fancy-code-spans">Fancy Code Spans</h2>
<p>
  An inline code span delimiter need not consist of exactly one
  backtick.  It can consist of any number of backticks.  So
  <code>`foo`</code> and <code>``foo``</code> produce identical HTML.
  There is another important but less well-known detail.  When the
  text inside an inline code span begins and ends with spaces, one
  space is removed from each end before rendering.  So
  <code>`foo`</code> and <code>` foo `</code> are equivalent.
  Therefore, when we need to put backticks within an inline code span,
  we can start the code span using multiple backticks and a space.
  For example:
</p>
<!-- Markdown #5 -->
<pre><code>Meet Corey's friend Becky Trace: `` `(o_o)` ``</code></pre>
<p>
  Here is the rendered output:
</p>
<!-- Rendered HTML #5 -->
<div class="box">
<p>Meet Corey's friend Becky Trace: <code>`(o_o)`</code></p>
</div>
<!-- Raw HTML #5 -->
<details>
<summary>View HTML</summary>
<pre><code>&lt;p&gt;Meet Corey's friend Becky Trace: &lt;code&gt;`(o_o)`&lt;/code&gt;&lt;/p&gt;</code></pre>
</details>
<p>
  Becky has her hair intact too.  We have avoided the mishap that once
  caused great distress to Corey.  That, my friends, is how backticks
  survive nesting in Markdown.
</p>
<h2 id="specification">Specification</h2>
<p>
  Before I finish this post, let us take a look at the CommonMark
  specification to see where these details are defined.  The excerpts
  quoted below are taken from
  <a href="https://spec.commonmark.org/0.30/">CommonMark Spec Version
  0.30</a>, which is by now over four years old.
</p>
<p>
  From section
  <a href="https://spec.commonmark.org/0.30/#fenced-code-blocks">4.5
  Fenced Code Blocks</a>:
</p>
<blockquote>
  <p>
    A <a href="https://spec.commonmark.org/0.30/#code-fence">code
    fence</a> is a sequence of at least three consecutive backtick
    characters (<code>`</code>) or tildes (<code>~</code>).  (Tildes
    and backticks cannot be mixed.)
  </p>
</blockquote>
<blockquote>
  <p>
    The content of the code block consists of all subsequent lines,
    until a closing
    <a href="https://spec.commonmark.org/0.30/#code-fence">code fence</a>
    of the same type as the code block began with (backticks or tildes),
    and with at least as many backticks or tildes as the opening code
    fence.
  </p>
</blockquote>
<p>
  From section
  <a href="https://spec.commonmark.org/0.30/#code-spans">6.1 Code
  Spans</a>:
</p>
<blockquote>
  <p>
    A <a href="https://spec.commonmark.org/0.30/#backtick-string">backtick
    string</a> is a string of one or more backtick characters
    (<code>`</code>) that is neither preceded nor followed by a
    backtick.
  </p>
  <p>
    A <a href="https://spec.commonmark.org/0.30/#code-span">code
    span</a> begins with a backtick string and ends with a backtick
    string of equal length.  The contents of the code span are the
    characters between these two backtick strings, normalized in the
    following ways:
  </p>
  <ul>
    <li>
      First, <a href="https://spec.commonmark.org/0.30/#line-ending">line endings</a>
      are converted to <a href="https://spec.commonmark.org/0.30/#space">spaces</a>.
    </li>
    <li>
      If the resulting string both begins <em>and</em> ends with a
      <a href="https://spec.commonmark.org/0.30/#space">space</a>
      character, but does not consist entirely of
      <a href="https://spec.commonmark.org/0.30/#space">space</a>
      characters, a single
      <a href="https://spec.commonmark.org/0.30/#space">space</a>
      character is removed from the front and back.  This allows you
      to include code that begins or ends with backtick characters,
      which must be separated by whitespace from the opening or
      closing backtick strings.
    </li>
  </ul>
</blockquote>
<p>
  I hope these little nuggets of Markdown trivialities will one day
  prove useful in your own Markdown misfortunes.
</p>
