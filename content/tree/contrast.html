<!--
  Colour Contrast Calculator
  Copyright (c) 2025 Susam Pal
  License: MIT
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Colour Contrast Calculator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Colour contrast calculator.">
    <style>
      body {
        font-family: georgia, serif;
        font-size: large;
        line-height: 1.5;
        margin: 0 auto;
        max-width: 40em;
        padding: 1em;
        text-align: center;
      }
      h1 {
        font-size: 1.5em;
        margin: 0em;
      }
      h2 {
        font-size: 1.2em;
        margin: 1.2em 0 0.5em 0;
      }
      input {
        font-family: monospace,monospace;
        font-size: 1em;
        padding: 0.5em;
        text-align: center;
        text-transform: uppercase;
        width: 8em;
      }
      #result {
        border: medium solid #666;
        display: inline-block;
        font-family: monospace,monospace;
        padding: 1em;
        width: 8em;
      }
      #preview {
        border: thin solid #999;
        display: inline-block;
        padding: 1em;
      }
      .ellipsis {
        font-family: monospace,monospace;
      }
    </style>
    <script>
      'use script'

      // Reference: https://www.w3.org/TR/WCAG20-TECHS/G17.html

      function contrast (r1, g1, b1, r2, g2, b2) {
        const la = luminance(r1, g1, b1)
        const lb = luminance(r2, g2, b2)
        const l1 = Math.max(la, lb)
        const l2 = Math.min(la, lb)
        return (l1 + 0.05) / (l2 + 0.05)
      }

      function luminance (r, g, b) {
        const rl = sRGBToLinear(r)
        const gl = sRGBToLinear(g)
        const bl = sRGBToLinear(b)
        return 0.2126 * rl + 0.7152 * gl + 0.0722 * bl
      }

      function sRGBToLinear (c) {
        c = c / 255
        if (c <= 0.03928) {
          return c / 12.92
        } else {
          return Math.pow((c + 0.055) / 1.055, 2.4)
        }
      }

      let fg
      let bg
      let result
      let preview
      let pangram
      let previewText
      let previewWidth

      function init () {
        fg = document.getElementById('fg')
        bg = document.getElementById('bg')
        result = document.getElementById('result')
        preview = document.getElementById('preview')
        previewText = preview.innerHTML
        previewWidth = preview.clientWidth

        fg.addEventListener('change', calc)
        fg.addEventListener('cut', calc)
        fg.addEventListener('keyup', calc)
        fg.addEventListener('paste', calc)
        fg.addEventListener('blur', recalc)

        bg.addEventListener('change', calc)
        bg.addEventListener('cut', calc)
        bg.addEventListener('keyup', calc)
        bg.addEventListener('paste', calc)
        bg.addEventListener('blur', recalc)

        calc()
      }

      function recalc (e) {
        let value = normalise(e.target.value).substring(1)
        if (value.length === 3) {
          value =
            value.charAt(0) + value.charAt(0) +
            value.charAt(1) + value.charAt(1) +
            value.charAt(2) + value.charAt(2)
        } else {
          return value
        }
        e.target.value = '#' + value
        calc()
      }

      function calc () {
        fg.value = normalise(fg.value)
        bg.value = normalise(bg.value)

        if (fg.value.length !== 7 || bg.value.length !== 7) {
          hide()
          return
        }

        const rf = parseInt(fg.value.substring(1, 3), 16)
        const gf = parseInt(fg.value.substring(3, 5), 16)
        const bf = parseInt(fg.value.substring(5, 7), 16)

        const rb = parseInt(bg.value.substring(1, 3), 16)
        const gb = parseInt(bg.value.substring(3, 5), 16)
        const bb = parseInt(bg.value.substring(5, 7), 16)

        const ratio = contrast(rf, gf, bf, rb, gb, bb)
        show(ratio)
      }

      function normalise (value) {
        value = value.toUpperCase().replace(/[^0-9A-F]/, '')
        return value === '' ? '' : '#' + value
      }

      function hide () {
        result.innerHTML = '...'
        preview.style.color = '#000000';
        preview.style.background = '#ffffff';
        preview.innerHTML = '<span class="ellipsis">...</span>'
        preview.style.width = previewWidth + 'px'
      }

      function show (ratio) {
        const r = Number.isInteger(ratio) ? ratio.toString() : ratio.toFixed(2)
        result.innerHTML = r + ':1'
        preview.style.color = fg.value
        preview.style.background = bg.value
        preview.innerHTML = previewText
        preview.style.width = previewWidth + 'px'
      }

      window.addEventListener('load', init)
    </script>
  </head>
  <body>
    <h1>Colour Contrast Calculator</h1>
    <h2>Foreground</h2>
    <input id="fg" minlength="6" maxlength="7" value="#000000">
    <h2>Background</h2>
    <input id="bg" minlength="6" maxlength="7" value="#FFFFFF">
    <h2>Contrast</h2>
    <div id="result"></div>
    <h2>Preview</h2>
    <div id="preview">The five boxing wizards jump quickly.</div>
  </body>
</html>
